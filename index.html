<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>TIME TABLE APP</h1>
        <div id="batch1" style="display: block;">
            <div><label>Enter course name: <input id="course1" name="course" type="text"/></label>
            <label>Select slot
                <select name="slot" id="slot1">
                    <option value="A1">A1</option>
                    <option value="B1">B1</option>
                    <option value="C1">C1</option>
                    <option value="D1">D1</option>
                    <option value="E1">E1</option>
                    <option value="F">F</option>
                    <option value="G">G</option>
                    <option value="H">H</option>
                    <option value="P1">P1</option>
                    <option value="Q1">Q1</option>
                    <option value="R1">R1</option>
                    <option value="S1">S1</option>
                    <option value="T1">T1</option>
                </select>
            </label>
            <label> Include Plus Slots 
                <input type="checkbox" id="Plus1" name="Plus" value="includePlus">
            </label>
            <button id = "submitbtn1">Add</button></div>
        

        <br><br>
        <table
        class="table table-bordered"
        class="table table-hover" 
        border="5" 
        cellspacing="0" 
        align="center" >
            <tr>
                <td align="center" height="50"
                    width="100" class="top"><br>
                    <b>Day/Period</b></br>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>I<br>8:00-8:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>II<br>9:00-9:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>III<br>10:00-10:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>IV<br>11:00-11:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>V<br>12:00-12:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>VI<br>1:00-1:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>VII<br>2:00-2:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>VIII<br>3:00-3:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>IX<br>4:00-4:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>X<br>5:00-5:50</b>
                </td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Monday</b></td>
                <td align="center" height="50" class="F 8:00am-8:50am-MO" id="11"></td>
                <td align="center" height="50" class="A1 9:00am-9:50am-MO" id="12"></td>
                <td align="center" height="50" class="B1 10:00am-10:50am-MO" id="13"></td>
                <td align="center" height="50" class="C1 11:00am-11:50am-MO" id="14"></td>
                <td align="center" height="50" class="D1+ 12:00pm-12:50pm-MO" id="15"></td>
                <td rowspan="6" align="center" height="50" class="lunch">
                    <h2>L<br>U<br>N<br>C<br>H</h2>
                </td>
                <td colspan="3" align="center"
                    height="50" class="P1 2:00pm-4:50pm-MO"></td>
                <td align="center" height="50" class="G 5:00pm-5:50pm-MO"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Tuesday</b>
                </td>
                <td align="center" height="50" class="H 8:00am-8:50am-TU"></td>
                <td align="center" height="50" class="B1 9:00am-9:50am-TU"></td>
                <td align="center" height="50" class="C1 10:00am-10:50am-TU"></td>
                <td align="center" height="50" class="D1 11:00am-11:50am-TU"></td>
                <td align="center" height="50" class="E1+ 12:00pm-12:50pm-TU"></td>
                <td colspan="3" align="center"
                    height="50" class="Q1 2:00pm-4:50pm-TU"></td>
                <td align="center" height="50" class="F 5:00pm-5:50pm-TU"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Wednesday</b>
                </td>
                <td align="center" height="50" class="G 8:00am-8:50am-WE"></td>
                <td align="center" height="50" class="C1 9:00am-9:50am-WE"></td>
                <td align="center" height="50" class="D1 10:00am-10:50am-WE"></td>
                <td align="center" height="50" class="E1 11:00am-11:50am-WE"></td>
                <td align="center" height="50" class="A1+ 12:00pm-12:50pm-WE"></td>
                <td colspan="3" align="center"
                    height="50" class="R1 2:00pm-4:50pm-WE">
                </td>
                <td align="center" height="50" class="H 5:00pm-5:50pm-WE"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Thursday</b>
                </td>
                <td align="center" height="50" class="F 8:00am-8:50am-TH"></td>
                <td align="center" height="50" class="D1 9:00am-9:50am-TH"></td>
                <td align="center" height="50" class="E1 10:00am-10:50am-TH"></td>
                <td align="center" height="50" class="A1 11:00am-11:50am-TH"></td>
                <td align="center" height="50" class="B1+ 12:00pm-12:50pm-TH"></td>
                <td colspan="3" align="center"
                    height="50" class="S1 2:00pm-4:50pm-TH">
                </td>
                <td align="center" height="50" class="G 5:00pm-5:50pm-TH"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Friday</b>
                </td>
                <td align="center" height="50" class="H 8:00am-8:50am-FR"></td>
                <td align="center" height="50" class="E1 9:00am-9:50am-FR"></td>
                <td align="center" height="50" class="A1 10:00am-10:50am-FR"></td>
                <td align="center" height="50" class="B1 11:00am-11:50am-FR"></td>
                <td align="center" height="50" class="C1+ 12:00pm-12:50pm-FR"></td>
                <td colspan="3" align="center"
                    height="50" class="T1 2:00pm-4:50pm-FR">
                </td>
                <td align="center" height="50" class="F+ 5:00pm-5:50pm-FR"></td>
            </tr>
        </table>
    </div>

    <!--     Second batch     -->
    <div id="batch2" style="display: none;">
            <div><label>Enter course name: <input id="course2" name="course" type="text"/></label>
            <label>Select slot
                <select name="slot" id="slot2">
                    <option value="A2">A2</option>
                    <option value="B2">B2</option>
                    <option value="C2">C2</option>
                    <option value="D2">D2</option>
                    <option value="E2">E2</option>
                    <option value="F">F</option>
                    <option value="G">G</option>
                    <option value="H">H</option>
                    <option value="P2">P2</option>
                    <option value="Q2">Q2</option>
                    <option value="R2">R2</option>
                    <option value="S2">S2</option>
                    <option value="T2">T2</option>
                </select>
            </label>
            <label> Include Plus Slots 
                <input type="checkbox" id="Plus2" name="Plus" value="includePlus">
            </label>
            <button id = "submitbtn2">Add</button></div>
        

        <br><br>
        <table
        class="table table-bordered"
        class="table table-hover" 
        border="5" 
        cellspacing="0" 
        align="center" >
            <tr>
                <td align="center" height="50"
                    width="100" class="top"><br>
                    <b>Day/Period</b></br>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>I<br>8:00-8:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>II<br>9:00-9:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>III<br>10:00-10:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>IV<br>11:00-11:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>V<br>12:00-12:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>VI<br>1:00-1:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>VII<br>2:00-2:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>VIII<br>3:00-3:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>IX<br>4:00-4:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>X<br>5:00-5:50</b>
                </td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Monday</b></td>
                <td align="center" height="50" class="F 8:00am-8:50am-MO" id="11"></td>
                <td colspan="3" align="center"
                    height="50" id="P2 9:00am-11:50am-MO"></td>
                <td rowspan="6" align="center" height="50" class="lunch">
                    <h2>L<br>U<br>N<br>C<br>H</h2>
                </td>
                <td align="center" height="50" class="D2+ 1:00pm-1:50pm-MO" id="12"></td>
                <td align="center" height="50" class="A2 2:00pm-2:50pm-MO" id="13"></td>
                <td align="center" height="50" class="B2 3:00pm-3:50pm-MO" id="14"></td>
                <td align="center" height="50" class="C2 4:00pm-4:50pm-MO" id="15"></td>
                <td align="center" height="50" class="G 5:00pm-5:50pm-MO"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Tuesday</b>
                </td>
                <td align="center" height="50" class="H 8:00am-8:50am-TU"></td>
                <td colspan="3" align="center"
                    height="50" class="Q2 9:00am-11:50am-TU"></td>
                <td align="center" height="50" class="E2+ 1:00pm-1:50pm-TU"></td>
                <td align="center" height="50" class="B2 2:00pm-2:50pm-TU"></td>
                <td align="center" height="50" class="C2 3:00pm-3:50pm-TU"></td>
                <td align="center" height="50" class="D2 4:00pm-4:50pm-TU"></td>
                <td align="center" height="50" class="F 5:00pm-5:50pm-TU"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Wednesday</b>
                </td>
                <td align="center" height="50" class="G 8:00am-8:50am-WE"></td>
                <td colspan="3" align="center"
                    height="50" class="R2 9:00am-11:50am-WE">
                </td>
                <td align="center" height="50" class="A2+ 1:00pm-1:50pm-WE"></td>
                <td align="center" height="50" class="C2 2:00pm-2:50pm-WE"></td>
                <td align="center" height="50" class="D2 3:00pm-3:50pm-WE"></td>
                <td align="center" height="50" class="E2 4:00pm-4:50pm-WE"></td>
                <td align="center" height="50" class="H 5:00pm-5:50pm-WE"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Thursday</b>
                </td>
                <td align="center" height="50" class="F 8:00am-8:50am-TH"></td>
                <td colspan="3" align="center"
                    height="50" class="S2 9:00am-11:50am-TH">
                </td>
                <td align="center" height="50" class="B2+ 1:00pm-1:50pm-TH"></td>
                <td align="center" height="50" class="D2 2:00pm-2:50pm-TH"></td>
                <td align="center" height="50" class="E2 3:00pm-3:50pm-TH"></td>
                <td align="center" height="50" class="A2 4:00pm-4:50pm-TH"></td>
                <td align="center" height="50" class="G 5:00pm-5:50pm-TH"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Friday</b>
                </td>
                <td align="center" height="50" class="H 8:00am-8:50am-FR"></td>
                <td colspan="3" align="center"
                    height="50" class="T2 9:00am-11:50am-FR">
                </td>
                <td align="center" height="50" class="C2+ 1:00pm-1:50pm-FR"></td>
                <td align="center" height="50" class="E2 2:00pm-2:50pm-FR"></td>
                <td align="center" height="50" class="A2 3:00pm-3:50pm-FR"></td>
                <td align="center" height="50" class="B2 4:00pm-4:50pm-FR"></td>
                <td align="center" height="50" class="F+ 5:00pm-5:50pm-FR"></td>
            </tr>
        </table>
    </div>
    <button id="batchChange">Switch batch</button>
    <button id="iCal">Download iCal</button>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
</body>
<script type="text/javascript">
    var saveAs=saveAs||function(e){"use strict";if(typeof e==="undefined"||typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,a=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},i=/constructor/i.test(e.HTMLElement)||e.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent),u=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},s="application/octet-stream",d=1e3*40,c=function(e){var t=function(){if(typeof e==="string"){n().revokeObjectURL(e)}else{e.remove()}};setTimeout(t,d)},l=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var o=e["on"+t[r]];if(typeof o==="function"){try{o.call(e,n||e)}catch(a){u(a)}}}},p=function(e){if(/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)){return new Blob([String.fromCharCode(65279),e],{type:e.type})}return e},v=function(t,u,d){if(!d){t=p(t)}var v=this,w=t.type,m=w===s,y,h=function(){l(v,"writestart progress write writeend".split(" "))},S=function(){if((f||m&&i)&&e.FileReader){var r=new FileReader;r.onloadend=function(){var t=f?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");var n=e.open(t,"_blank");if(!n)e.location.href=t;t=undefined;v.readyState=v.DONE;h()};r.readAsDataURL(t);v.readyState=v.INIT;return}if(!y){y=n().createObjectURL(t)}if(m){e.location.href=y}else{var o=e.open(y,"_blank");if(!o){e.location.href=y}}v.readyState=v.DONE;h();c(y)};v.readyState=v.INIT;if(o){y=n().createObjectURL(t);setTimeout(function(){r.href=y;r.download=u;a(r);h();c(y);v.readyState=v.DONE});return}S()},w=v.prototype,m=function(e,t,n){return new v(e,t||e.name||"download",n)};if(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob){return function(e,t,n){t=t||e.name||"download";if(!n){e=p(e)}return navigator.msSaveOrOpenBlob(e,t)}}w.abort=function(){};w.readyState=w.INIT=0;w.WRITING=1;w.DONE=2;w.error=w.onwritestart=w.onprogress=w.onwrite=w.onabort=w.onerror=w.onwriteend=null;return m}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content);if(typeof module!=="undefined"&&module.exports){module.exports.saveAs=saveAs}else if(typeof define!=="undefined"&&define!==null&&define.amd!==null){define("FileSaver.js",function(){return saveAs})}

    var ics=function(e,t){"use strict";{if(!(navigator.userAgent.indexOf("MSIE")>-1&&-1==navigator.userAgent.indexOf("MSIE 10"))){void 0===e&&(e="default"),void 0===t&&(t="Calendar");var r=-1!==navigator.appVersion.indexOf("Win")?"\r\n":"\n",n=[],i=["BEGIN:VCALENDAR","PRODID:"+t,"VERSION:2.0"].join(r),o=r+"END:VCALENDAR",a=["SU","MO","TU","WE","TH","FR","SA"];return{events:function(){return n},calendar:function(){return i+r+n.join(r)+o},addEvent:function(t,i,o,l,u,s){if(void 0===t||void 0===i||void 0===o||void 0===l||void 0===u)return!1;if(s&&!s.rrule){if("YEARLY"!==s.freq&&"MONTHLY"!==s.freq&&"WEEKLY"!==s.freq&&"DAILY"!==s.freq)throw"Recurrence rrule frequency must be provided and be one of the following: 'YEARLY', 'MONTHLY', 'WEEKLY', or 'DAILY'";if(s.until&&isNaN(Date.parse(s.until)))throw"Recurrence rrule 'until' must be a valid date string";if(s.interval&&isNaN(parseInt(s.interval)))throw"Recurrence rrule 'interval' must be an integer";if(s.count&&isNaN(parseInt(s.count)))throw"Recurrence rrule 'count' must be an integer";if(void 0!==s.byday){if("[object Array]"!==Object.prototype.toString.call(s.byday))throw"Recurrence rrule 'byday' must be an array";if(s.byday.length>7)throw"Recurrence rrule 'byday' array must not be longer than the 7 days in a week";s.byday=s.byday.filter(function(e,t){return s.byday.indexOf(e)==t});for(var c in s.byday)if(a.indexOf(s.byday[c])<0)throw"Recurrence rrule 'byday' values must include only the following: 'SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'"}}var g=new Date(l),d=new Date(u),f=new Date,S=("0000"+g.getFullYear().toString()).slice(-4),E=("00"+(g.getMonth()+1).toString()).slice(-2),v=("00"+g.getDate().toString()).slice(-2),y=("00"+g.getHours().toString()).slice(-2),A=("00"+g.getMinutes().toString()).slice(-2),T=("00"+g.getSeconds().toString()).slice(-2),b=("0000"+d.getFullYear().toString()).slice(-4),D=("00"+(d.getMonth()+1).toString()).slice(-2),N=("00"+d.getDate().toString()).slice(-2),h=("00"+d.getHours().toString()).slice(-2),I=("00"+d.getMinutes().toString()).slice(-2),R=("00"+d.getMinutes().toString()).slice(-2),M=("0000"+f.getFullYear().toString()).slice(-4),w=("00"+(f.getMonth()+1).toString()).slice(-2),L=("00"+f.getDate().toString()).slice(-2),O=("00"+f.getHours().toString()).slice(-2),p=("00"+f.getMinutes().toString()).slice(-2),Y=("00"+f.getMinutes().toString()).slice(-2),U="",V="";y+A+T+h+I+R!=0&&(U="T"+y+A+T,V="T"+h+I+R);var B,C=S+E+v+U,j=b+D+N+V,m=M+w+L+("T"+O+p+Y);if(s)if(s.rrule)B=s.rrule;else{if(B="rrule:FREQ="+s.freq,s.until){var x=new Date(Date.parse(s.until)).toISOString();B+=";UNTIL="+x.substring(0,x.length-13).replace(/[-]/g,"")+"000000Z"}s.interval&&(B+=";INTERVAL="+s.interval),s.count&&(B+=";COUNT="+s.count),s.byday&&s.byday.length>0&&(B+=";BYDAY="+s.byday.join(","))}(new Date).toISOString();var H=["BEGIN:VEVENT","UID:"+n.length+"@"+e,"CLASS:PUBLIC","DESCRIPTION:"+i,"DTSTAMP;VALUE=DATE-TIME:"+m,"DTSTART;VALUE=DATE-TIME:"+C,"DTEND;VALUE=DATE-TIME:"+j,"LOCATION:"+o,"SUMMARY;LANGUAGE=en-us:"+t,"TRANSP:TRANSPARENT","END:VEVENT"];return B&&H.splice(4,0,B),H=H.join(r),n.push(H),H},download:function(e,t){if(n.length<1)return!1;t=void 0!==t?t:".ics",e=void 0!==e?e:"calendar";var a,l=i+r+n.join(r)+o;if(-1===navigator.userAgent.indexOf("MSIE 10"))a=new Blob([l]);else{var u=new BlobBuilder;u.append(l),a=u.getBlob("text/x-vCalendar;charset="+document.characterSet)}return saveAs(a,e+t),l},build:function(){return!(n.length<1)&&i+r+n.join(r)+o}}}console.log("Unsupported Browser")}};
  </script>
 <script>

    let batch = 1;
    let inEdit = false;

    function validateForm()
    {
        let courseName = document.getElementById("course" + batch).value;
        let slot = document.getElementById("slot" + batch).value;
        let checked = document.getElementById("Plus" + batch);
        let slots = document.getElementsByClassName(slot);
        let slotsPlus = document.getElementsByClassName(slot + "+");
        for(var i = 0; i < slots.length; i++)
            slots[i].innerHTML = courseName;
        if(checked.checked)
            for(var i = 0; i < slotsPlus.length; i++)
                slotsPlus[i].innerHTML = courseName + "(+)";
        document.getElementById("course" + batch).value = "";
        document.getElementById("slot" + batch).value = "A" + batch;
        checked.checked = false;
    }

    function addText()
    {
        if(this.classList[0] == "lunch" || this.classList[0] == "top" || this.classList[0] == "side" || inEdit)
            return;
        inEdit = true;
        var input = document.createElement("input");
        input.value = this.innerHTML;
        input.size = 8;
        this.innerHTML = "";
        this.appendChild(input);
        input.focus();
        input.addEventListener("focusout", () => {
            input.parentElement.innerHTML = input.value;
            input.remove();
            inEdit = false;
        });
    }

    document.querySelectorAll("td").forEach(e => e.addEventListener("click", addText));

    var btn = document.getElementById("submitbtn1");
    btn.addEventListener("click", validateForm);
    document.getElementById("submitbtn2").addEventListener("click", validateForm);

    document.getElementById("batchChange").addEventListener("click", () =>{
        // document.getElementById("batch" + batch).toggle("slide");
        // alert("adgdf");
        // batch == 1 ? batch = 2 : batch = 1;
        // document.getElementById("batch" + batch).show("slide", { direction: "right" }, 1000);
        document.getElementById("batch" + batch).style.display = "none";
        batch == 1 ? batch = 2 : batch = 1;
        document.getElementById("batch" + batch).style.display = "block";
    });

    // $("#batchChange").click(function() {
    //     $("#batch"+batch).toggle("slide");
    //     alert("adgdf");
    //     batch == 1 ? batch = 2 : batch = 1;
    // });

    function generateUUID() { // Public Domain/MIT
    var d = new Date().getTime();//Timestamp
    var d2 = ((typeof performance !== 'undefined') && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16;//random number between 0 and 16
        if(d > 0){//Use timestamp until depleted
            r = (d + r)%16 | 0;
            d = Math.floor(d/16);
        } else {//Use microseconds since page-load if supported
            r = (d2 + r)%16 | 0;
            d2 = Math.floor(d2/16);
        }
        return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
    });
}

    document.getElementById("iCal").addEventListener("click", () => {
        var calText="BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:TimeTableApp\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH";
        document.querySelectorAll("td").forEach(e => {
            var text = e.innerHTML.trim();
            const date = new Date();
            var d1 = Date.UTC(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds())
            d1 = d1.toISOString();
            console.log(d1);
            if(e.classList[0] == "lunch" || e.classList[0] == "top" || e.classList[0] == "side" || text == "")
                return;
            var t = e.classList[1].split("-");
            calText += "\nBEGIN:VEVENT\nSUMMARY:" + text + "\nUID:"+ generateUUID() +"\nRRULE:FREQ=WEEKLY;INTERVAL=1;BYDAY="+ t[2] +"\nDTSTART:20230101\nDTEND:20230430\nDTSTAMP:"+ d1 +"\nEND:VEVENT";
        });
        calText += "\nEND:VCALENDAR";

        console.log(calText);
    });
 </script>

 
</html>