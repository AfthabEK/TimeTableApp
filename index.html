<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>TIME TABLE APP</h1>
        <div id="batch1" style="display: block;">
            <div><label>Enter course name: <input id="course1" name="course" type="text"/></label>
            <label>Select slot
                <select name="slot" id="slot1">
                    <option value="A1">A1</option>
                    <option value="B1">B1</option>
                    <option value="C1">C1</option>
                    <option value="D1">D1</option>
                    <option value="E1">E1</option>
                    <option value="F">F</option>
                    <option value="G">G</option>
                    <option value="H">H</option>
                    <option value="P1">P1</option>
                    <option value="Q1">Q1</option>
                    <option value="R1">R1</option>
                    <option value="S1">S1</option>
                    <option value="T1">T1</option>
                </select>
            </label>
            <label> Include Plus Slots 
                <input type="checkbox" id="Plus1" name="Plus" value="includePlus">
            </label>
            <button id = "submitbtn1">Add</button></div>
        

        <br><br>
        <table id="table1"
        class="table table-bordered"
        class="table table-hover" 
        border="5" 
        cellspacing="0" 
        align="center" >
            <tr>
                <td align="center" height="50"
                    width="100" class="top"><br>
                    <b>Day/Period</b></br>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>I<br>8:00-8:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>II<br>9:00-9:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>III<br>10:00-10:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>IV<br>11:00-11:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>V<br>12:00-12:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>VI<br>1:00-1:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>VII<br>2:00-2:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>VIII<br>3:00-3:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>IX<br>4:00-4:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>X<br>5:00-5:50</b>
                </td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Monday</b></td>
                <td align="center" height="50" class="F 8:00am-8:50am-MO" id="11"></td>
                <td align="center" height="50" class="A1 9:00am-9:50am-MO" id="12"></td>
                <td align="center" height="50" class="B1 10:00am-10:50am-MO" id="13"></td>
                <td align="center" height="50" class="C1 11:00am-11:50am-MO" id="14"></td>
                <td align="center" height="50" class="D1+ 12:00pm-12:50pm-MO" id="15"></td>
                <td rowspan="6" align="center" height="50" class="lunch">
                    <h2>L<br>U<br>N<br>C<br>H</h2>
                </td>
                <td colspan="3" align="center"
                    height="50" class="P1 2:00pm-4:50pm-MO"></td>
                <td align="center" height="50" class="G 5:00pm-5:50pm-MO"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Tuesday</b>
                </td>
                <td align="center" height="50" class="H 8:00am-8:50am-TU"></td>
                <td align="center" height="50" class="B1 9:00am-9:50am-TU"></td>
                <td align="center" height="50" class="C1 10:00am-10:50am-TU"></td>
                <td align="center" height="50" class="D1 11:00am-11:50am-TU"></td>
                <td align="center" height="50" class="E1+ 12:00pm-12:50pm-TU"></td>
                <td colspan="3" align="center"
                    height="50" class="Q1 2:00pm-4:50pm-TU"></td>
                <td align="center" height="50" class="F 5:00pm-5:50pm-TU"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Wednesday</b>
                </td>
                <td align="center" height="50" class="G 8:00am-8:50am-WE"></td>
                <td align="center" height="50" class="C1 9:00am-9:50am-WE"></td>
                <td align="center" height="50" class="D1 10:00am-10:50am-WE"></td>
                <td align="center" height="50" class="E1 11:00am-11:50am-WE"></td>
                <td align="center" height="50" class="A1+ 12:00pm-12:50pm-WE"></td>
                <td colspan="3" align="center"
                    height="50" class="R1 2:00pm-4:50pm-WE">
                </td>
                <td align="center" height="50" class="H 5:00pm-5:50pm-WE"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Thursday</b>
                </td>
                <td align="center" height="50" class="F 8:00am-8:50am-TH"></td>
                <td align="center" height="50" class="D1 9:00am-9:50am-TH"></td>
                <td align="center" height="50" class="E1 10:00am-10:50am-TH"></td>
                <td align="center" height="50" class="A1 11:00am-11:50am-TH"></td>
                <td align="center" height="50" class="B1+ 12:00pm-12:50pm-TH"></td>
                <td colspan="3" align="center"
                    height="50" class="S1 2:00pm-4:50pm-TH">
                </td>
                <td align="center" height="50" class="G 5:00pm-5:50pm-TH"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Friday</b>
                </td>
                <td align="center" height="50" class="H 8:00am-8:50am-FR"></td>
                <td align="center" height="50" class="E1 9:00am-9:50am-FR"></td>
                <td align="center" height="50" class="A1 10:00am-10:50am-FR"></td>
                <td align="center" height="50" class="B1 11:00am-11:50am-FR"></td>
                <td align="center" height="50" class="C1+ 12:00pm-12:50pm-FR"></td>
                <td colspan="3" align="center"
                    height="50" class="T1 2:00pm-4:50pm-FR">
                </td>
                <td align="center" height="50" class="F+ 5:00pm-5:50pm-FR"></td>
            </tr>
        </table>
    </div>

    <!--     Second batch     -->
    <div id="batch2" style="display: none;">
            <div><label>Enter course name: <input id="course2" name="course" type="text"/></label>
            <label>Select slot
                <select name="slot" id="slot2">
                    <option value="A2">A2</option>
                    <option value="B2">B2</option>
                    <option value="C2">C2</option>
                    <option value="D2">D2</option>
                    <option value="E2">E2</option>
                    <option value="F">F</option>
                    <option value="G">G</option>
                    <option value="H">H</option>
                    <option value="P2">P2</option>
                    <option value="Q2">Q2</option>
                    <option value="R2">R2</option>
                    <option value="S2">S2</option>
                    <option value="T2">T2</option>
                </select>
            </label>
            <label> Include Plus Slots 
                <input type="checkbox" id="Plus2" name="Plus" value="includePlus">
            </label>
            <button id = "submitbtn2">Add</button></div>
        

        <br><br>
        <table id="table2"
        class="table table-bordered"
        class="table table-hover" 
        border="5" 
        cellspacing="0" 
        align="center" >
            <tr>
                <td align="center" height="50"
                    width="100" class="top"><br>
                    <b>Day/Period</b></br>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>I<br>8:00-8:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>II<br>9:00-9:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>III<br>10:00-10:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>IV<br>11:00-11:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>V<br>12:00-12:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>VI<br>1:00-1:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>VII<br>2:00-2:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>VIII<br>3:00-3:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>IX<br>4:00-4:50</b>
                </td>
                <td align="center" height="50"
                    width="100" class="top">
                    <b>X<br>5:00-5:50</b>
                </td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Monday</b></td>
                <td align="center" height="50" class="F 8:00am-8:50am-MO" id="11"></td>
                <td colspan="3" align="center"
                    height="50" id="P2 9:00am-11:50am-MO"></td>
                <td rowspan="6" align="center" height="50" class="lunch">
                    <h2>L<br>U<br>N<br>C<br>H</h2>
                </td>
                <td align="center" height="50" class="D2+ 1:00pm-1:50pm-MO" id="12"></td>
                <td align="center" height="50" class="A2 2:00pm-2:50pm-MO" id="13"></td>
                <td align="center" height="50" class="B2 3:00pm-3:50pm-MO" id="14"></td>
                <td align="center" height="50" class="C2 4:00pm-4:50pm-MO" id="15"></td>
                <td align="center" height="50" class="G 5:00pm-5:50pm-MO"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Tuesday</b>
                </td>
                <td align="center" height="50" class="H 8:00am-8:50am-TU"></td>
                <td colspan="3" align="center"
                    height="50" class="Q2 9:00am-11:50am-TU"></td>
                <td align="center" height="50" class="E2+ 1:00pm-1:50pm-TU"></td>
                <td align="center" height="50" class="B2 2:00pm-2:50pm-TU"></td>
                <td align="center" height="50" class="C2 3:00pm-3:50pm-TU"></td>
                <td align="center" height="50" class="D2 4:00pm-4:50pm-TU"></td>
                <td align="center" height="50" class="F 5:00pm-5:50pm-TU"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Wednesday</b>
                </td>
                <td align="center" height="50" class="G 8:00am-8:50am-WE"></td>
                <td colspan="3" align="center"
                    height="50" class="R2 9:00am-11:50am-WE">
                </td>
                <td align="center" height="50" class="A2+ 1:00pm-1:50pm-WE"></td>
                <td align="center" height="50" class="C2 2:00pm-2:50pm-WE"></td>
                <td align="center" height="50" class="D2 3:00pm-3:50pm-WE"></td>
                <td align="center" height="50" class="E2 4:00pm-4:50pm-WE"></td>
                <td align="center" height="50" class="H 5:00pm-5:50pm-WE"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Thursday</b>
                </td>
                <td align="center" height="50" class="F 8:00am-8:50am-TH"></td>
                <td colspan="3" align="center"
                    height="50" class="S2 9:00am-11:50am-TH">
                </td>
                <td align="center" height="50" class="B2+ 1:00pm-1:50pm-TH"></td>
                <td align="center" height="50" class="D2 2:00pm-2:50pm-TH"></td>
                <td align="center" height="50" class="E2 3:00pm-3:50pm-TH"></td>
                <td align="center" height="50" class="A2 4:00pm-4:50pm-TH"></td>
                <td align="center" height="50" class="G 5:00pm-5:50pm-TH"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Friday</b>
                </td>
                <td align="center" height="50" class="H 8:00am-8:50am-FR"></td>
                <td colspan="3" align="center"
                    height="50" class="T2 9:00am-11:50am-FR">
                </td>
                <td align="center" height="50" class="C2+ 1:00pm-1:50pm-FR"></td>
                <td align="center" height="50" class="E2 2:00pm-2:50pm-FR"></td>
                <td align="center" height="50" class="A2 3:00pm-3:50pm-FR"></td>
                <td align="center" height="50" class="B2 4:00pm-4:50pm-FR"></td>
                <td align="center" height="50" class="F+ 5:00pm-5:50pm-FR"></td>
            </tr>
        </table>
    </div>
    <button id="batchChange">Switch batch</button>

    <button id="pdfdownload">Download PDF</button>
    <button id="iCal">Download iCal</button>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js"></script>

    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    </body>
    <script>


    let batch = 1;
    let inEdit = false;

    function validateForm()
    {
        let courseName = document.getElementById("course" + batch).value;
        let slot = document.getElementById("slot" + batch).value;
        let checked = document.getElementById("Plus" + batch);
        let slots = document.getElementsByClassName(slot);
              
        let slotsPlus = document.getElementsByClassName(slot + "+");
        for(var i = 0; i < slots.length; i++)
            slots[i].innerHTML = courseName;
        if(checked.checked)
            for(var i = 0; i < slotsPlus.length; i++)
                slotsPlus[i].innerHTML = courseName + "(+)";
        document.getElementById("course" + batch).value = "";
        document.getElementById("slot" + batch).value = "A" + batch;
        checked.checked = false;
    }
	
	//function for editing each cell induvidually
    function addText()
    {
        if(this.classList[0] == "lunch" || this.classList[0] == "top" || this.classList[0] == "side" || inEdit)
            return;
        inEdit = true;
        var input = document.createElement("input");
        input.value = this.innerHTML;
        input.size = 8;
        this.innerHTML = "";
        this.appendChild(input);
        input.focus();
        input.addEventListener("focusout", () => {
            input.parentElement.innerHTML = input.value;
            input.remove();
            inEdit = false;
        });
    }
    


	//function for pdf download
	function exportpdf() {
   		var source = '#table1';
   		if (batch == 2) {
   			source = '#table2';
   		}
   		
   		var doc = new jsPDF('l', 'pt', 'a4');
    	var htmlstring = '';
    	var tempVarToCheckPageHeight = 0;
    	var pageHeight = 0;
    	pageHeight = doc.internal.pageSize.height;
    	specialElementHandlers = {
        	// element with id of "bypass" - jQuery style selector  
        	'#bypassme': function (element, renderer) {
            	// true = "handled elsewhere, bypass text extraction"  
            	return true
        	}
    	};
    	margins = {
        	top: 150,
        	bottom: 60,
        	left: 20,
        	right: 20,
        	width: 600
    	};
    	var y = 20;
    	doc.setLineWidth(2);
    	doc.autoTable({
        	html: source,  //sets the id of the table to be downloaded
        	startY: 70,
        	theme: 'grid',
        	columnStyles: {
        	    0: {
        	        cellWidth: 75,
        	    },
        	    1: {
        	        cellWidth: 70,
        	    },
        	    2: {
        	        cellWidth: 70,
        	    },
        	    3: {
        	        cellWidth: 70,
        	    },
        	    4: {
        	        cellWidth: 70,
        	    },
        	    5: {
        	        cellWidth: 70,
        	    },
        	    6: {
        	        cellWidth: 70,
        	    },
        	    7: {
        	        cellWidth: 70,
        	    },
        	    8: {
        	        cellWidth: 70,
        	    },
        	    9: {
        	        cellWidth: 70,
        	    },
        	    10: {
        	        cellWidth: 70,
        	    },
        	    11: {
        	        cellWidth: 70,
        	    }
        	},
        	styles: {
        	    minCellHeight: 40
        	}
    	})
    	doc.save('output.pdf');
	}
	
    document.querySelectorAll("td").forEach(e => e.addEventListener("click", addText));
    
	
	//event handler for submit button
    var btn = document.getElementById("submitbtn1");
    btn.addEventListener("click", validateForm);
    document.getElementById("submitbtn2").addEventListener("click", validateForm);
    
    //event handler for pdf download button
    var pdfbtn = document.getElementById("pdfdownload");
    pdfbtn.addEventListener("click", exportpdf);
	
	//event handler for switching between batches
    document.getElementById("batchChange").addEventListener("click", () =>{
        document.getElementById("batch" + batch).style.display = "none";
        batch == 1 ? batch = 2 : batch = 1;
        document.getElementById("batch" + batch).style.display = "block";
    });

    function generateUUID() { // Public Domain/MIT
    var d = new Date().getTime();//Timestamp
    var d2 = ((typeof performance !== 'undefined') && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16;//random number between 0 and 16
        if(d > 0){//Use timestamp until depleted
            r = (d + r)%16 | 0;
            d = Math.floor(d/16);
        } else {//Use microseconds since page-load if supported
            r = (d2 + r)%16 | 0;
            d2 = Math.floor(d2/16);
        }
        return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
    });
}

    document.getElementById("iCal").addEventListener("click", () => {
        var calText="BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:TimeTableApp\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH";
        document.querySelectorAll("td").forEach(e => {
            var text = e.innerHTML.trim();
            const date = new Date();
            var d1 = Date.UTC(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds())
            d1 = d1.toISOString();
            console.log(d1);
            if(e.classList[0] == "lunch" || e.classList[0] == "top" || e.classList[0] == "side" || text == "")
                return;
            var t = e.classList[1].split("-");
            calText += "\nBEGIN:VEVENT\nSUMMARY:" + text + "\nUID:"+ generateUUID() +"\nRRULE:FREQ=WEEKLY;INTERVAL=1;BYDAY="+ t[2] +"\nDTSTART:20230101\nDTEND:20230430\nDTSTAMP:"+ d1 +"\nEND:VEVENT";
        });
        calText += "\nEND:VCALENDAR";

        console.log(calText);
    });
 </script>
</html>

